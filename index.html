<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>netvr</title>

    <script src="https://www.unpkg.com/jquery@3.6.0/dist/jquery.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/worldwindjs@1.8.0/build/dist/worldwind.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/osmtogeojson@3.0.0-beta.4/osmtogeojson.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js" type="text/javascript"></script>

    <!-- https://forkaweso.me/Fork-Awesome/icons/ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">


    <!-- https://taginfo.openstreetmap.org/download -->



    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.18.2/cytoscape.min.js" type="text/javascript"></script>-->

    <style>
        body {
            background-color: black;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            position: fixed;
        }
        .full {
            position: fixed; width: 100%; height: 100%; margin: 0; padding: 0;
        }
        .side {
            position: fixed; width: 25%; height: 100%; margin: 0; padding: 0;
        }
        #mode_menu {
            color: white;
        }
        .topmenu {
            display: grid;
            /*pointer-events:none;*/
        }
        #mode_raw {
            max-height: 12em;
            overflow: scroll;
        }

        #mode_idiocracy button {
            margin: 1em;
            opacity:0.75;
            font-size: 200%;
            font-family:monospace;
            pointer-events:painted;
        }
    </style>

<!--    <script src="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.js" type="text/javascript"></script>-->
<!--    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.css">-->

</head>
<body>
    <canvas id="map" class="full">
        HTML5 Canvas Unsupported
    </canvas>
    <!-- TODO mode select -->

    <!-- TODO raw amenity mode -->

    <!-- idiocracy mode -->
    <div id="root" class="side topmenu">
<!--        <div data-demo-html="true">-->
<!--            <div data-role="tabs" id="tabs">-->
<!--                <div data-role="navbar">-->
<!--                    <ul>-->
<!--                        <li><a href="#one" data-ajax="false">one</a></li>-->
<!--                        <li><a href="#two" data-ajax="false">two</a></li>-->
<!--                        <li><a href="ajax-content-ignore.html" data-ajax="false">three</a></li>-->
<!--                    </ul>-->
<!--                </div>-->
<!--                <div id="one" class="ui-body-d ui-content">-->
<!--                    <h1>First tab contents</h1>-->
<!--                </div>-->
<!--                <div id="two">-->
<!--                    <ul data-role="listview" data-inset="true">-->
<!--                        <li><a href="#">Acura</a></li>-->
<!--                        <li><a href="#">Audi</a></li>-->
<!--                        <li><a href="#">BMW</a></li>-->
<!--                        <li><a href="#">Cadillac</a></li>-->
<!--                        <li><a href="#">Ferrari</a></li>-->
<!--                    </ul>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

        <div id="mode_menu">
            <button title="Clear"><i class="fa fa-times" aria-hidden="true"></i></button>
            <button title="Amenity"><i class="fa fa-wrench" aria-hidden="true"></i></button>
            <button title="Idiocracy"><i class="fa fa-trophy" aria-hidden="true"></i></button>
        </div>
        <div id="mode_raw">
        </div>
        <div id="mode_idiocracy">
            <button>fuck</button>
            <button>shit</button>
            <button>play</button>
            <button>slep</button>
            <button>eaat</button>
        </div>
    </div>

<script>
    "use strict";

    window.addEventListener("load", () => {

        const w = new WorldWind.WorldWindow("map");

        //w.addLayer(new WorldWind.BMNGOneImageLayer());
        //w.addLayer(new WorldWind.BingAerialWithLabelsLayer());
        w.addLayer(new WorldWind.OpenStreetMapImageLayer());
        w.addLayer(new WorldWind.AtmosphereLayer());

        //w.addLayer(new WorldWind.CompassLayer());
        //w.addLayer(new WorldWind.CoordinatesDisplayLayer(wwd));
        //w.addLayer(new WorldWind.ViewControlsLayer(wwd));

        {
            $.ajax({
                url: 'osm.tags.popular.json',
            }).done(tags => {
                const raw = $('#mode_raw');
               _.forEach(tags.data, tag=>{
                   const key = tag.key, value = tag.value;

                   //filters
                   if (key === 'source' || key === 'start_date' || key === 'gauge')
                       return;

                   raw.append($('<button>').append(key + '=' + value));
               });
            });
        }
        {
            const placemarkAttributes = new WorldWind.PlacemarkAttributes(null);
            placemarkAttributes.imageScale = 0.05;
            placemarkAttributes.imageColor = WorldWind.Color.WHITE;
            placemarkAttributes.labelAttributes.offset = new WorldWind.Offset(
                WorldWind.OFFSET_FRACTION, 0.5,
                WorldWind.OFFSET_FRACTION, 1.5);
            placemarkAttributes.imageSource = WorldWind.configuration.baseUrl + "images/white-dot.png";

            const shapeConfigurationCallback = (geometry, properties) => {
                const configuration = {};

                if (geometry.isPointType() || geometry.isMultiPointType()) {
                    configuration.attributes = new WorldWind.PlacemarkAttributes(placemarkAttributes);

                    if (properties && (properties.name || properties.Name || properties.NAME)) {
                        configuration.name = properties.name || properties.Name || properties.NAME;
                    }
                    if (properties && properties.POP_MAX) {
                        const population = properties.POP_MAX;
                        configuration.attributes.imageScale = 0.01 * Math.log(population);
                    }
                } else if (geometry.isLineStringType() || geometry.isMultiLineStringType()) {
                    configuration.attributes = new WorldWind.ShapeAttributes(null);
                    configuration.attributes.drawOutline = true;
                    configuration.attributes.outlineColor = new WorldWind.Color(
                        0.1 * configuration.attributes.interiorColor.red,
                        0.3 * configuration.attributes.interiorColor.green,
                        0.7 * configuration.attributes.interiorColor.blue,
                        1.0);
                    configuration.attributes.outlineWidth = 2.0;
                } else if (geometry.isPolygonType() || geometry.isMultiPolygonType()) {
                    configuration.attributes = new WorldWind.ShapeAttributes(null);

                    // Fill the polygon with a random pastel color.
                    configuration.attributes.interiorColor = new WorldWind.Color(
                        0.375 + 0.5 * Math.random(),
                        0.375 + 0.5 * Math.random(),
                        0.375 + 0.5 * Math.random(),
                        0.5);
                    // Paint the outline in a darker variant of the interior color.
                    configuration.attributes.outlineColor = new WorldWind.Color(
                        0.5 * configuration.attributes.interiorColor.red,
                        0.5 * configuration.attributes.interiorColor.green,
                        0.5 * configuration.attributes.interiorColor.blue,
                        1.0);
                }

                return configuration;
            };

            // const query =
            //     "node\n" +
            //     "  [amenity=drinking_water]\n" +
            //     "  (40.7638, -73.98584, 40.78568, -73.95189);\n" +
            //     "out;"

            $.ajax({
                url: 'https://overpass-api.de/api/interpreter?data=%2F*%0AThis%20is%20an%20example%20Overpass%20query.%0ATry%20it%20out%20by%20pressing%20the%20Run%20button%20above%21%0AYou%20can%20find%20more%20examples%20with%20the%20Load%20tool.%0A*%2F%0Anode%0A%20%20%5Bamenity%3Ddrinking_water%5D%0A%20%20%2840.76380376778105%2C-73.98583889007568%2C40.78567563696274%2C-73.9518928527832%29%3B%0Aout%3B',
            }).done(osm_data => {
                const geojson = osmtogeojson(osm_data);
                //console.log(geojson);

                const polygonLayer = new WorldWind.RenderableLayer("GeoJSON");
                //const resourcesUrl = "https://worldwind.arc.nasa.gov/web/examples/data/geojson-data/";
                //const polygonGeoJSON = new WorldWind.GeoJSONParser(resourcesUrl + "PolygonTest.geojson");
                const polygonGeoJSON = new WorldWind.GeoJSONParser(geojson);
                polygonGeoJSON.load(null, shapeConfigurationCallback, polygonLayer);
                w.addLayer(polygonLayer);
            });

        }


        // var cy = cytoscape({
        //
        //     container: document.getElementById('root'), // container to render in
        //
        //     elements: [ // list of graph elements to start with
        //         {data: { id: 'fuck' }},
        //         {data: { id: 'shit' }},
        //         {data: { id: 'play' }},
        //         {data: { id: 'sleep' }},
        //         {data: { id: 'eat' }}
        //         /*,
        //         {
        //             data: { id: 'ab', source: 'a', target: 'b' }
        //         }*/
        //     ],
        //
        //     style: [ // the stylesheet for the graph
        //         {
        //             selector: 'node',
        //             style: {
        //                 'background-color': '#666',
        //                 'label': 'data(id)'
        //             }
        //         },
        //
        //         {
        //             selector: 'edge',
        //             style: {
        //                 'width': 3,
        //                 'line-color': '#ccc',
        //                 'target-arrow-color': '#ccc',
        //                 'target-arrow-shape': 'triangle',
        //                 'curve-style': 'bezier'
        //             }
        //         }
        //     ],
        //
        //     layout: {
        //         name: 'cose',
        //         rows: 2
        //     }
        //
        // });
        // cy.userPanningEnabled( false );
        // cy.boxSelectionEnabled( false );
        // cy.removeListener('tap');

    }, false);

</script>
</body>
</html>
